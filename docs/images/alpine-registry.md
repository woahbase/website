---
description: MultiArch Alpine Linux + S6 + Docker Registry v2 + genuinetools/Reg for WebUI
svcname: registry
has_services:
  - compose
  - nomad
has_proxies:
  - nginx
tags:
  - package
  - s6
  - service
---

{% import "macros.md" as m with context %}
{% include "shields.md" %}

This [image][155] containerizes [docker-registry][1] to store and
distribute docker images to multiple hosts in the local network.
For web ui, this image contains [reg][4], but for newer builds,
[Docker-Registry-UI][5] ([Github][6]) or an equivalent frontend
may be preferred instead.

{{ m.srcimage('alpine-s6') }} with the {{ m.alpinepkg('docker-registry') }}
package installed in it.

{% include "pull-image.md" %}

---
Run
---

Running the container starts the service.

``` sh
docker run --rm \
  --name docker_registry \
  -p 4999:4999 \
  -p 5000:5000 \
  -p 5001:5001 \
  -v $PWD/data:/data \
woahbase/alpine-registry
```

--8<-- "multiarch.md"

---
##### Configuration
---

We can customize the runtime behaviour of the container with the
following environment variables.

| ENV Vars                                  | Default                                    | Description
| :---                                      | :---                                       | :---
| CONF_YML                                  | /data/config.yml                           | Path to registry configuration file.
| REGISTRY_AUTH_HTPASSWD_PATH               | /data/auth/.htpasswd                       | Path to registry authentication file. Generated if not exists.
| REGISTRY_AUTH_HTPASSWD_REALM              | Basic-Realm                                | Registry Authentication realm.
| REGISTRY_HTTP_HOST                        | https://localhost:5000                     | Registry http host.
| REGISTRY_HTTP_SECRET                      | such-secure-much-wow                       | Registry http secret. (**Must** set your own)
| REGISTRY_HTTP_TLS_CERTIFICATE             | /data/auth/certificate.crt                 | Path to certificate file. Generated if not exists.
| REGISTRY_HTTP_TLS_KEY                     | /data/auth/privatekey.pem                  | Path to private key file. Generated if not exists.
| REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY | /data/storage                              | Root directory for image-store.
| REGISTRY_PERMFIX_REPOS                    | unset                                      | If set to `true`, ensures files inside image-store are owned/accessible by `S6_USER`. {{ m.sincev('2.8.3_20240910') }}
| REG_ASSET_PATH                            | /data/web                                  | Path when web assets generated by `reg` are stored.
| REG_PASS                                  | insecurebydefault                          | Default user, also used by `reg` for accessing the registry.
| REG_USER                                  | registry                                   | Default user password, also used by `reg` for accessing the registry.
| REG_ARGS                                  | --interval 1h0m0s --listen-address 0.0.0.0 | Customizable arguments passed to `reg` service.
{% include "envvars/alpine-s6.md" %}

--8<-- "check-id.md"

Also,

* {{ m.defcfgfile('/data/config.yml', fr='docker `registry`', vname='CONF_YML') }}

* Data at `/data/storage`.

* Default configuration binds port `5000` to `registry` API,
  `5001` to `reg`, and `4999` to `registry` debug port used for
  metrics or healthcheck.

* Checkout their [docs][2] or [configuration guide][7] to
  customize your own, or [this link][3] to get started.

* For caching metadata using `redis`, check the
  {{ m.myimage('alpine-redis') }} image.

[1]: https://docs.docker.com/registry/
[2]: https://docs.docker.com/registry/configuration/
[3]: https://medium.com/@ifeanyiigili/how-to-setup-a-private-docker-registry-with-a-self-sign-certificate-43a7407a1613
[4]: https://github.com/genuinetools/reg
[5]: https://joxit.dev/docker-registry-ui/
[6]: https://github.com/Joxit/docker-registry-ui
[7]: https://distribution.github.io/distribution/about/configuration/

{% include "all-include.md" %}
